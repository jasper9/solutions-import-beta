define(function(require){var $=require("jquery"),_=require("underscore"),compiledNoticeTemplate=require("hbs!template/notice"),compiledEmailPartnerSupportTemplate=require("hbs!template/emailPartnerSupport"),cu=require("util/appDirCommon"),cp=require("model/commonProperties"),email=require("model/email"),jqURL=require("jqURL"),jqUI=require("jqUI");function noticeModal(templateValues){var content=compiledNoticeTemplate(templateValues);cp.get("noticeModalWrapper").html(content),cp.get("noticeModal").modal()}function getBase(){return $(document.documentElement).length>0?$(document.documentElement):$(document.body)}function generateEmailTemplate(options){options||{};var queryParams=$.url().param(),emailProperties=new email(_.extend({repoUname:queryParams.uname,repoName:queryParams.repo,repoBranch:queryParams.branch},options));if(!emailProperties.isValid()){cu.log("emailProperties invalid: "+JSON.stringify(emailProperties));return}return compiledEmailPartnerSupportTemplate(emailProperties.toJSON())}function updateFormDisplay(options){var msg,clazz;_.isEqual(options.rdcClass,ALERT_SUCCESS_CLASSES)?(msg="Success "+options.rdMsgVal,clazz="success main-state-deploy-success"):_.isEqual(options.rdcClass,ALERT_ERROR_CLASSES)&&(msg="Error! "+options.rdMsgVal,clazz="notification-bulb-error"),cp.get("responseDataControl").removeClass("hidden").removeAttr("class").addClass(clazz),cp.get("responseData").empty().html(msg),cu.log("error: "+JSON.stringify(options))}function openWindow(url,windowName){var openOperation=$.Deferred(),checkInterval=1500,isBlocked=function(width,height){var target=getBase();return width=width?width:1,height=height?height:1,_.isUndefined(target.clientWidth)||_.isUndefined(target.clientHeight)||target.clientWidth>=width||target.clientHeight>=height},checkWindowBlocked=function(){isBlocked()?(cu.log("Window blocked so rejecting"),openOperation.reject()):(cu.log("newWindow innerWidth: "+newWindow.innerWidth+" resolving"),openOperation.resolve())},newWindow=window.open(url,windowName);return!newWindow&&cp.get("page-index").hasClass("ff-true")?(cu.log("Window open returned undefined so rejecting"),openOperation.reject()):cp.get("page-index").hasClass("chrome-true")?setTimeout(checkWindowBlocked,checkInterval):(cu.log("Window open returned fine so resolving"),openOperation.resolve()),openOperation}function displayIframe(iframeOptions){assert(iframeOptions,"No iFrame options provided"),assert(iframeOptions.id,"No target id to append iFrame to provided"),assert(iframeOptions.src,"No iFrame url provided");var $targetIframe,$target=$("#"+iframeOptions.id),iframeId=iframeOptions.id+"_iframe",iframeName=iframeOptions.name?iframeOptions.name+"_iframe":iframeId,jqiframeId="#"+iframeId;if($(jqiframeId).is("iframe")){cu.log("Found existing iframeid removing."),$(jqiframeId).remove();return}var realIframeOptions=_.extend({},{id:iframeId,name:iframeName,css:iframeOptions.cssObj?iframeOptions.cssObj:""},_.pick(iframeOptions,"src","seamless","srcdoc","sandbox"));cu.log("Creating iframe with the following attributes: "+JSON.stringify(realIframeOptions)),$targetIframe=$("<iframe />",realIframeOptions).hide(),$targetIframe.appendTo($target).show("highlight",1e3)}return{noticeModal:function(values){return noticeModal(values)},openWindow:function(url){return openWindow(url)},updateFormDisplay:function(options){return updateFormDisplay(options)},displayIframe:function(iframeOptions){return displayIframe(iframeOptions)},getBase:function(){return getBase()},generateEmailTemplate:function(options){return generateEmailTemplate(options)}}});